{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home assistant","text":"<p>Home Assistant est un logiciel domotique open source que j'utilise afin de rendre ma maison \"intelligente\".</p> <p>Je vais vous pr\u00e9senter les principaux sc\u00e9narios d'automatisation que j'utilise au quotidien.</p>"},{"location":"#installation","title":"Installation","text":"<p>L'application est d\u00e9ploy\u00e9e sur une machine physique \u00e0 domicile, dont voici la configuration.</p>"},{"location":"#automatisations","title":"Automatisations","text":"<p>L'objectif est de mettre en place des actions automatiques en r\u00e9ponse \u00e0 des \u00e9v\u00e9nements survenant au sein de la maison.</p> <ul> <li>Allumer des lumi\u00e8res au r\u00e9veil</li> <li>Notification de connexion</li> <li>Rappel arrosage de mon bonsai</li> <li>Trajet domicile/travail</li> <li>T\u00e9l\u00e9vision</li> <li>Mode nuit</li> <li>Gestion du chauffage</li> </ul>"},{"location":"#mes-sources-dinspiration","title":"Mes sources d'inspiration","text":"<ul> <li>The Anchorage House Home Assistant Configuration</li> <li>Isabella Gross Alstr\u00f6m Home Assistant Configuration</li> </ul>"},{"location":"202305050718_watchtower/","title":"Mise \u00e0 jour automatique de Home assistant","text":"<p>Note</p> <p>Objectif : Mettre \u00e0 jour le container docker Home Assistant avec la derni\u00e8re version publi\u00e9e</p>"},{"location":"202305050718_watchtower/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<p>Un serveur NAS h\u00e9bergeant Home Assistant en utilisant des containers docker.</p> <p>xxxxxxxxxxx ajouter un lien vers un article sur le nas et la publication en https du HA (certificat, domaine, mqqt, ...) xxxxxxxxxxx</p>"},{"location":"202305050718_watchtower/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>J'ai choisi d'installer Watchtower, sous la forme d'un container docker,  pour automatiser la mise \u00e0 jour de <code>Home Assistant</code>.</p> <p>Le logiciel propose de nombreuses options, parmi lesquelles j'ai selectionn\u00e9 les suivantes:</p> <ul> <li>WATCHTOWER_CLEANUP=true, permet de supprimer les anciennes versions de l'image docker qui ne sont plus utilis\u00e9es. Cela permet de ne pas remplir son disque dur inutilement,</li> <li>WATCHTOWER_LABEL_ENABLE=true, permet de mettre \u00e0 jour uniquement les containers contenant le label <code>com.centurylinklabs.watchtower.enable=true</code>. , </li> <li>WATCHTOWER_RUN_ONCE=true, permet de lancer la mont\u00e9e de version \u00e0 la demande. Le container se lance, fait ce qu'il doit faire, puis s'arr\u00eate.</li> </ul> <p><pre><code>version: \"3\"\nservices:\nwatchtower:\nimage: containrrr/watchtower\nvolumes:\n- /var/run/docker.sock:/var/run/docker.sock\nenvironment:\n- WATCHTOWER_CLEANUP=true\n- WATCHTOWER_LABEL_ENABLE=true\n- WATCHTOWER_RUN_ONCE=true\nlabels:\n- \"com.centurylinklabs.watchtower.enable=true\"\n</code></pre> .docker-compose  watchtower</p>"},{"location":"202305102057_nas/","title":"Configuration serveur","text":""},{"location":"202305102057_nas/#machine-utilisee","title":"Machine utilis\u00e9e","text":"<p>Mon installation est faite sur un NAS que j'utilise aussi comme syst\u00e8me de sauvegarde pour les ordinateurs de la maison.</p> <p>Le serveur ayant d\u00e9j\u00e0 un syst\u00e8me d'exploitation et d'autres applications install\u00e9es, j'ai opt\u00e9 pour une installation dans des containers docker afin de la rendre independante du reste du syst\u00e8me.</p>"},{"location":"202305102057_nas/#hebergement-local-de-home-assistant","title":"H\u00e9bergement local de Home Assistant","text":"<p>La publication de l'application n\u00e9cessite les \u00e9l\u00e9ments suivant :</p> <ul> <li>un nom de domaine,</li> <li>un  proxy pour lier le nom de domaine \u00e0 l'application locale,</li> <li>un certificat pour publier  le site en https</li> </ul>"},{"location":"202305102057_nas/#gestion-du-nom-de-domaine","title":"Gestion du nom de domaine","text":"<p>Au lieu d'acheter un nom de domaine, j'utilise un sous domaine gratuit propos\u00e9 par le site duckdns.org. Cela donne une adresse du type <code>ma-maison.duckdns.org</code>.</p> <p>Une fois le sous domaine d\u00e9clar\u00e9, il faut lui associer l'adresse ip, visible depuis internet, du serveur h\u00e9bergeant Home Assistant, ou dans mon cas l'adresse de ma box internet (une r\u00e8gle de routage au niveau de la box fait alors la rediction vers le serveur nas).</p> <p>Cette association est faite par un autre container docker linuxserver/duckdns, qui va p\u00e9riodiquement r\u00e9cup\u00e9rer l'adresse externe de la box et l'associer au nom de domaine duckdns. Cela est utile quand l'adresse ip externe fournie par son fournisseur d'acc\u00e8s \u00e0 internet n'est pas fixe.</p> <p>Voici un exemple de configuration :</p> <pre><code>duckdns:\nimage: lscr.io/linuxserver/duckdns\ncontainer_name: duckdns\nenvironment:\n- TZ=Europe/Paris\n- SUBDOMAINS=ma-maison.duckdns.org\n- TOKEN=xxx-xxx-xxx # (1)\nrestart: unless-stopped\n</code></pre> <ol> <li>Token fournis lors de la cr\u00e9ation du compte duckdns.</li> </ol> <p>Tip</p> <p>Ce container peut \u00eatre remplac\u00e9 par une int\u00e9gration Home Assistant duckdns.</p>"},{"location":"202305102057_nas/#application-proxy-et-certificat-ssl","title":"Application proxy et certificat SSL","text":"<p>J'ai choisi Traefik car il permet :</p> <ul> <li>la cr\u00e9ation et le renouvellement d'un certificat Let's encrypt.</li> <li>d'exposer d'autres containers docker grace \u00e0 des annotations pos\u00e9es sur ceux ci.</li> </ul> <p>Le container est d\u00e9clar\u00e9 de la fa\u00e7on suivante :</p> <pre><code>traefik:\nhostname: traefik\nimage: traefik:v2.9\ncontainer_name: traefik\nrestart: always\ndomainname: ma-maison.duckdns.org # (1)\nnetwork_mode: host\ncommand:\n- --providers.docker=true # (2)\n- --providers.docker.exposedbydefault=false # (3)\n- --entrypoints.web.address=:80 # (4)\n- --entrypoints.websecure.address=:443 # (5)\n- --entryPoints.web.forwardedHeaders.trustedIPs=127.0.0.1/32,192.168.1.69 # (6)\n- --entrypoints.websecure.http.tls.certresolver=myresolver\n- --certificatesresolvers.myresolver.acme.email=xxxx.xxxx@gmail.com\n- --certificatesresolvers.myresolver.acme.dnschallenge.provider=duckdns # (7)\n- --certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json environment:\n- DUCKDNS_TOKEN=xxx-xxx-xxx # (8)\nports:\n- \"80:80\"\n- \"443:443\"\nvolumes:\n- \"/data/docker/traefik:/letsencrypt\"\n- \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n</code></pre> <ol> <li>Nom du sous domaine duckdns</li> <li>Utilise les labels associ\u00e9s aux containers docker pour les exposer ou non</li> <li>N'expose que les containers avec le label <code>traefik.enable=true</code></li> <li>Port pour le trafique http </li> <li>Port pour le trafique https</li> <li>Liste des IP autoris\u00e9es</li> <li>Configuration let's encrypt pour un challenge de type DNS</li> <li>Token duckdns : permet \u00e0 traefik d'\u00e9crire un enregistrement texte au niveau du DNS afin de prouver que le domaine nous appartient avant de nous delivrer un certificat.</li> </ol>"},{"location":"202305102057_nas/#outils-complementaires","title":"Outils compl\u00e9mentaires","text":""},{"location":"202305102057_nas/#interface-dadministration","title":"Interface d'administration","text":"<p>Portainer est une interface d'administration qui permet d'ajouter ou de mettre \u00e0 jour des containers, mais aussi de le d\u00e9marrer ou de les arr\u00eater.</p>"},{"location":"automatisations/01-reveil/","title":"R\u00e9veil","text":"<p>Objectif</p> <p>Allumer 2 lampes \u00e0 l'heure du r\u00e9veil.</p>"},{"location":"automatisations/01-reveil/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>2 ampoules de marque Wiz positionn\u00e9es dans le salon et la salle \u00e0 manger</li> <li>1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour r\u00e9cup\u00e9rer l'heure de la prochaine alarme (heure de r\u00e9veil).</li> </ul>"},{"location":"automatisations/01-reveil/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>Les ampoules de la marque Wiz peuvent \u00eatre int\u00e9gr\u00e9es automatiquement dans Home Assistant avec l'int\u00e9gration Wiz.</p>"},{"location":"automatisations/01-reveil/#script-reveil","title":"Script r\u00e9veil","text":"<p>Permet d'allumer les ampoules et de r\u00e9gler puissance et temp\u00e9rature.</p> <pre><code>scripts:\nreveil:\nalias: reveil\nsequence:\n- service: light.turn_on\ndata:\nbrightness: 80\ncolor_temp: 1000000\nentity_id: light.salle_a_manger\n- service: light.turn_on\ndata: {}\nentity_id: light.salon\nmode: single\nicon: mdi:alarm\n</code></pre>"},{"location":"automatisations/01-reveil/#automation","title":"Automation","text":"<p>L'automation se base sur l'heure  de la prochaine alarme remont\u00e9e par l'application mobile  :  sensor.pixel_2_xl_next_alarm.</p> <p>Le script reveil est appel\u00e9 quand l'heure de reveil est atteinte si le mode vacance n'a pas \u00e9t\u00e9 activ\u00e9.</p> <pre><code>automation:\n- id: lumierereveil\nalias: allumer lumi\u00e8res au r\u00e9veil\ntrigger:\n- platform: template\nvalue_template: &gt;\n{{now().strftime(\"%a %h %d %H:%M %Z %Y\") == (((state_attr('sensor.pixel_2_xl_next_alarm', 'Time in Milliseconds') | int / 1000) + 0*60 ) | timestamp_custom('%a %h %d %H:%M %Z %Y'))}}\ncondition:\n- condition: state\nentity_id: input_boolean.mode_vacance\nstate: 'off'\naction:\n- service: script.reveil\n</code></pre>"},{"location":"automatisations/02-ssh-login-notification/","title":"Notification de connexion","text":"<p>Objectif</p> <p>Envoyer une notification lors d'une connexion en ssh sur mon serveur NAS.</p>"},{"location":"automatisations/02-ssh-login-notification/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>1 serveur NAS permettant la connexion distante par ssh</li> <li>1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour recevoir la notification.</li> </ul>"},{"location":"automatisations/02-ssh-login-notification/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>Lors d'une connexion ssh les commandes pr\u00e9sentes dans le fichier /etc/ssh/sshrc sont ex\u00e9cut\u00e9es. En ajoutant les lignes de commandes suivantes il est possible d'appeler un WEBHOOK au niveau de Home Assistant.</p>"},{"location":"automatisations/02-ssh-login-notification/#sshrc","title":"sshrc","text":"<pre><code>#!/bin/bash\nip=$(echo \"$SSH_CONNECTION\" | cut -d \" \" -f 1)\nhs=$(hostname)\nhostIP=\"$(ip address show dev eth0 | grep \"inet \" | head --lines=1 | cut --delimiter=' ' --fields=6 | cut --delimiter='/' --fields=1)\"\nlogger -t ssh-wrapper \"$USER\" login from \"$ip\"\ncurl --header \"Content-Type: application/json\" \\\n--request POST \\\n--data \\\n'{\"topic\": \"'\"$hs\"'\",\n \"host\": \"'\"$hs\"'\",\n \"hostIP\": \"'\"$hostIP\"'\",\n \"user\": \"'\"$USER\"'\",\n \"from\": \"'\"$ip\"'\",\n \"message\": \"'\"$USER@$hs just logged in from $ip\"'\"}' \\\nhttp://localhost:8123/api/webhook/MY-SSH-WEBHOOK\n</code></pre> <p>La derni\u00e8re ligne doit \u00eatre adapt\u00e9e avec l'adresse de votre instance Home Assistant. Dans mon cas, elle est situ\u00e9e sur la m\u00eame machine.</p>"},{"location":"automatisations/02-ssh-login-notification/#traitement-du-webhook","title":"Traitement du WEBHOOK","text":"<p>A la r\u00e9ception du WEBHOOK, le sensor ssh_login prend la valeur du message envoy\u00e9 (bob@nas just logged in from 192.168.1.2 par exemple).</p> <p>Au changement de valeur du sensor ssh_login, le service de notification est appel\u00e9 avec le message stock\u00e9 sur le sensor.</p> <pre><code>automation:\n- id: ssh_login_notify\nalias: notify nas ssh login\ntrigger:\n- platform: state\nentity_id: sensor.ssh_login\naction:\nservice: notify.mobile_app_pixel_2_xl\ndata:\nmessage: '{{ states.sensor.ssh_login.state }}'\ntemplate:\n- trigger:\n- platform: webhook\nwebhook_id: MY-SSH-WEBHOOK\nsensor:\n- name: \"ssh_login\"\nstate: \"{{ trigger.json.message }}\"\n</code></pre>"},{"location":"automatisations/03-bonsai/","title":"Arrosage","text":"<p>Objectif</p> <p>Se rappeler de la date du dernier arrosage de mon bonsai en scannant un tag NFC pr\u00e9sent dans la soucoupe et envoyer une notification de rappel quand la date de prochain arrosage est atteinte.</p>"},{"location":"automatisations/03-bonsai/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>1 badge NFC pouvant \u00eatre \u00e9crit par Home Assistant</li> <li>1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour recevoir la notification.</li> </ul>"},{"location":"automatisations/03-bonsai/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/03-bonsai/#parametrage-du-delai-entre-deux-arrosages","title":"Param\u00e9trage du d\u00e9lai entre deux arrosages","text":"<pre><code>input_number:\ninterval_arrosage:\nname: Interval en jour entre 2 arrosages initial: 3\nmin: 1\nmax: 7\nstep: 1\nmode: box\n</code></pre>"},{"location":"automatisations/03-bonsai/#date-dernierprochain-arrosage","title":"Date dernier/prochain arrosage","text":"<pre><code>input_datetime:\ndate_arrosage:\nname: date dernier arrosage\nhas_date: true\nhas_time: false\ndate_next_arrosage:\nname: date prochain arrosage\nhas_date: true\nhas_time: false\n</code></pre>"},{"location":"automatisations/03-bonsai/#lecture-du-badge-nfc","title":"Lecture du badge NFC","text":"<pre><code>automation:\n- id: 'update_date_arrosage'\nalias: La balise bonsai est analys\u00e9e\ndescription: ''\ntrigger:\n- platform: tag\ntag_id: 2fbab09d-6347-4042-8165-1a35c0877a7f\ncondition: []\naction:\n- service: input_datetime.set_datetime\ndata:\ndatetime: \"{{ now().strftime('%Y-%m-%d') }}\"\nentity_id: input_datetime.date_arrosage\n- service: input_datetime.set_datetime\ndata:\ndatetime: \"{{ (now() + timedelta(days=states('input_number.interval_arrosage')| int + 1)).strftime('%Y-%m-%d') }}\"\nentity_id: input_datetime.date_next_arrosage\nmode: single\n</code></pre>"},{"location":"automatisations/03-bonsai/#notification","title":"Notification","text":"<pre><code>automation:\n- id: 'rappelArrosage'\nalias: rappel arrosage Bonsai\ntrigger:\n- platform: time\nat: \"17:00:00\"\ncondition:\n- condition: state\nentity_id: input_boolean.mode_vacance\nstate: 'off'\n- condition: template\nvalue_template: \"{{ states('sensor.date') &gt; states('input_datetime.date_next_arrosage') }}\"\naction:\n- service: notify.mobile_app_pixel_2_xl\ndata:\nmessage: 'Il est temps d'arroser le Bonsai'\n- service: input_datetime.set_datetime\ndata:\ndatetime: \"{{ (now() + timedelta(days=1)).strftime('%Y-%m-%d') }}\"\nentity_id: input_datetime.date_next_arrosage\n</code></pre>"},{"location":"automatisations/03-bonsai/#interface","title":"Interface","text":"<pre><code>type: picture-glance\ntitle: Carmona microphylla\nimage: ./local/bonsai.jpg\nentities:\n- entity: input_datetime.date_arrosage\n- entity: input_datetime.date_next_arrosage\n- entity: input_number.interval_arrosage\nentity: input_datetime.date_arrosage\n</code></pre> Vue du widget dans l'application"},{"location":"automatisations/04-trajet/","title":"Trajet domicile/travail","text":"<p>Objectif : Es-tu bien arriv\u00e9 \u00e0 destination, \u00e0 quelle heure rentres-tu ?</p> <p>Envoyer une notification \u00e0 l'arriv\u00e9e sur mon lieu de travail et une autre lors du retour au domicile avec indication du temps de trajet estim\u00e9.</p>"},{"location":"automatisations/04-trajet/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>2 t\u00e9l\u00e9phones portables sur lesquels sont install\u00e9 l'application mobile Home assistant pour recevoir la notification et partager sa localisation.</li> </ul>"},{"location":"automatisations/04-trajet/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>2 zones d\u00e9finies au niveau de Home assistant :</p> <ul> <li>home : adresse du domicile</li> <li>travail : adresse du lieu de travail</li> </ul>"},{"location":"automatisations/04-trajet/#estimation-du-temps-de-trajet-retour","title":"Estimation du temps de trajet retour","text":"<pre><code>sensor:\n- platform: waze_travel_time\nname: \"Vieux codeur ETT Home\"\norigin: device_tracker.pixel_2_xl_2\ndestination: zone.home\nregion: 'EU'\n</code></pre>"},{"location":"automatisations/04-trajet/#notification-arrivee-travail","title":"Notification arriv\u00e9e travail","text":"<pre><code>automation:\n- id: vieux_codeur_travail\nalias: Vieux codeur est arriv\u00e9 \u00e0 Travail\ninitial_state: true\ntrigger:\n- platform: zone\nevent: enter\nzone: zone.travail\nentity_id: person.vieuxcodeur\ncondition:\n- condition: time\nafter: \"07:30:00\"\nbefore: \"09:30:00\"\nweekday:\n- mon\n- tue\n- wed\n- thu\n- fri\naction:\n- service: notify.mobile_vieillecodeuse\ndata:\nmessage: 'Vieux codeur est arriv\u00e9 \u00e0 Travail'\n</code></pre>"},{"location":"automatisations/04-trajet/#notification-retour-a-la-maison","title":"Notification retour \u00e0 la maison","text":"<pre><code>automation:\n- id: vieuxcodeur_retour\nalias: Vieux codeur part de Travail\ninitial_state: true\ntrigger:\n- platform: zone\nevent: leave\nzone: zone.travail\nentity_id: person.mobile_app_pixel_2_xl\ncondition:\n- condition: time\nafter: \"18:00:00\"\nbefore: \"21:00:00\"\nweekday:\n- mon\n- tue\n- wed\n- thu\n- fri\naction:\n- service: notify.mobile_vieillecodeuse\ndata:\nmessage: \"Vieux codeur rentre du travail, arriv\u00e9e dans {{states.sensor.vieux_codeur_ett_home.state|round} minutes.\"\n</code></pre>"},{"location":"automatisations/05-tv/","title":"TV non connect\u00e9e","text":"<p>Objectif : Connecter \u00e0 Home Assistant une t\u00e9l\u00e9vision non connect\u00e9e</p>"},{"location":"automatisations/05-tv/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>une t\u00e9l\u00e9vision non connect\u00e9e</li> <li>Google Chromecast (cl\u00e9 Hdmi wifi permettant de diffuser un contenu sur une t\u00e9l\u00e9vision depuis des applications mobiles comme Netflix ou Youtube)</li> <li>une t\u00e9l\u00e9commande universelle connect\u00e9e: Broadlink  RM mini.  </li> </ul>"},{"location":"automatisations/05-tv/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/05-tv/#declaration-dun-capteur-onoff-pour-la-tv","title":"D\u00e9claration d'un capteur on/off pour la TV","text":"<p>Le chromecast, <code>media_player.salon</code>, est aliment\u00e9 quand la t\u00e9l\u00e9vision est allum\u00e9e et positionne le capteur <code>tv_template</code> a on. </p> <pre><code>sensor:\n- platform: template\nsensors:\ntv_template:\nunique_id: tv_template\nfriendly_name: 'TV Salon'\nvalue_template: \"{{ 'off' if is_state('media_player.salon', 'unavailable') else 'on' }}\"\nicon_template: \"{{ 'mdi:close-circle' if is_state('media_player.salon', 'unavailable') else 'mdi:monitor' }}\"   </code></pre>"},{"location":"automatisations/05-tv/#script-permettant-dallumer-ou-deteindre-la-tv","title":"Script permettant d'allumer ou d'\u00e9teindre la TV","text":"<p>L'int\u00e9gration Broadlink RM mini se configure directement depuis l'interface de Home Assistant.</p> <p>Le RM mini, <code>remote.bro_remote</code>, envoi la commande power lors de l'ex\u00e9cution du script, et allume la t\u00e9l\u00e9vision. Cette commande a \u00e9t\u00e9 au pr\u00e9ablable enregist\u00e9e \u00e0 partir de la t\u00e9l\u00e9commande d'origine et stock\u00e9e dans le r\u00e9pertoire .storage de Home Assistant. </p> <pre><code>scripts:\ntv_onoff:\nalias: tv_on\nsequence:\n- service: remote.send_command\ndata:\nentity_id: remote.bro_remote\ndevice: tv\ncommand: power\nentity_id: remote.bro_remote\nmode: single\n</code></pre>"},{"location":"automatisations/05-tv/#automatisations","title":"Automatisations","text":"<p>Il est maintenant possible de concevoir des automatisations \u00e0 partir de l'\u00e9tat de la TV (on/off) et du script permettant de l'allumer ou de l'\u00e9teindre.</p>"},{"location":"automatisations/06-mode-nuit/","title":"Mode nuit","text":"<p>Objectif : Eteindre les appareils rest\u00e9s allum\u00e9s lors du couch\u00e9 en scannant un tag NFC</p>"},{"location":"automatisations/06-mode-nuit/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>1 badge NFC pouvant \u00eatre \u00e9crit par Home Assistant</li> <li>une t\u00e9l\u00e9commande universelle connect\u00e9e: Broadlink  RM mini.</li> <li>1 t\u00e9l\u00e9vision non connect\u00e9e </li> <li>1 barre de son Yamaha MusicCast</li> <li>3 ampoules de marque Wiz positionn\u00e9es dans le salon et la salle \u00e0 manger</li> </ul>"},{"location":"automatisations/06-mode-nuit/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/06-mode-nuit/#lecture-du-badge-nfc","title":"Lecture du badge NFC","text":"<pre><code>- id: '1612460915835'\nalias: La balise nuit est analys\u00e9e\ndescription: ''\ntrigger:\n- platform: tag\ntag_id: d23152c3-01e7-48a7-b82b-ab989ba2c686\ncondition: []\naction:\n- service: script.sleep\ndata: {}\nmode: single\n</code></pre>"},{"location":"automatisations/06-mode-nuit/#groupe-de-lampes","title":"Groupe de lampes","text":"<p>Le groupe permet d'agir sur une liste de lampes en une seule action.</p> <pre><code>light:\n- platform: group\nname: Lumi\u00e8res salon\nentities:\n- light.salon\n- light.salon2\n- light.salle_a_manger\n</code></pre>"},{"location":"automatisations/06-mode-nuit/#script-eteignant-les-appareils","title":"Script \u00e9teignant les appareils","text":"<ul> <li> <p>Le <code>device</code> 42e5549cdbc8b0094de6a194ffcbf2bf correspond \u00e0 la barre de son.</p> </li> <li> <p>Le script tv_onoff permet d'allumer ou d'\u00e9teindre la TV.</p> </li> </ul> <pre><code>script:\nsleep:\nalias: sleep\nsequence:\n- service: light.turn_off\ndata: {}\nentity_id: light.lumieres_salon\n- service: media_player.turn_off\ndata: {}\ntarget:\ndevice_id: 42e5549cdbc8b0094de6a194ffcbf2bf\n- condition: state\nentity_id: sensor.tv_template\nstate: 'on'\n- service: script.tv_onoff\ndata: {}\nmode: single\nicon: mdi:sleep\n</code></pre>"},{"location":"automatisations/07-chauffage/","title":"Gestion du chauffage","text":"<p>Objectif : Connecter \u00e0 Home Assistant une pompe \u00e0 chaleur non connect\u00e9e</p>"},{"location":"automatisations/07-chauffage/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>une sonde wifi pour r\u00e9cup\u00e9rer la temp\u00e9rature et le taux d'humidit\u00e9 de la pi\u00e8ce \u00e0 chauffer</li> <li>une pompe \u00e0 chaleur non connect\u00e9e \u00e9quip\u00e9e d'une t\u00e9l\u00e9commande infrarouge</li> <li>une t\u00e9l\u00e9commande universelle connect\u00e9e: Broadlink  RM mini.  </li> </ul>"},{"location":"automatisations/07-chauffage/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/07-chauffage/#ajout-de-la-sonde-de-temperature","title":"Ajout de la sonde de temp\u00e9rature","text":"<p>La sonde utilis\u00e9e est une sonde  Shelly H&amp;T qui fonctionne sur le r\u00e9seau local en wifi, sans envoyer de donn\u00e9e sur un serveur distant.</p> <p>Une fois aliment\u00e9e, la sonde propose un r\u00e9seau wifi auquel il faut se connecter pour acc\u00e8der \u00e0 sa page de configutation (http://192.168.33.1). Cela permet de renseigner le SSID de son propre r\u00e9seau.  </p> <p>L'ajout dans Home Assistant se fait alors simplement avec l'int\u00e9gration Shelly, fournie par d\u00e9faut.</p>"},{"location":"automatisations/07-chauffage/#declaration-de-la-pompe-a-chaleur","title":"D\u00e9claration de la pompe \u00e0 chaleur","text":"<p>La pompe a chaleur est ajout\u00e9e \u00e0 Home assistant via l'int\u00e9gration (custom) SmartIR</p> <pre><code>smartir:\nclimate:\n- platform: smartir\nname: Salon AC\nunique_id: saloon_ac\ndevice_code: 1263\ncontroller_data: remote.rmminisalon\ntemperature_sensor: sensor.shellyht_7020b3_temperature\nhumidity_sensor: sensor.shellyht_7020b3_humidity\n</code></pre> <p><code>temperature_sensor</code> et <code>humidity_sensor</code> correpondent aux capteurs de temp\u00e9rature et d'humidit\u00e9 de la sonde Shelly.</p> <p><code>device_code</code> correspond au mod\u00e8le de pompe \u00e0 chaleur utilis\u00e9e pour laquelle les diff\u00e9rents codes pouvant \u00eatre envoy\u00e9s par la t\u00e9l\u00e9commande infrarouge sont connus de <code>SmartIR</code>.</p> <p><code>controller_data</code> r\u00e9f\u00e9rence la t\u00e9l\u00e9commande universelle utilis\u00e9e (Broadlink RM mini) pour piloter la pompe \u00e0 chaleur.</p> <p>L'int\u00e9gration Broadlink RM mini se configure directement depuis l'interface de Home Assistant.</p>"},{"location":"automatisations/07-chauffage/#automatisations","title":"Automatisations","text":"<p>Le chauffage est \u00e9teint si :</p> <ul> <li>la temp\u00e9rature de la pi\u00e8ce d\u00e9passe 21\u00b0 pendant 10 minutes,</li> <li>la pompe \u00e0 chaleur est en mode chauffage. </li> </ul> <p>Le seuil de 21 est positionn\u00e9 plus haut que la temp\u00e9rature demand\u00e9e \u00e0 la pompe \u00e0 chaleur pour \u00e9viter des arr\u00eats/red\u00e9marrages multiples. Ce seuil sera atteint par exemple par jour de beau temps o\u00f9 le soleil va faire monter la temp\u00e9rature au dela de la temp\u00e9rature souhait\u00e9e.</p> <pre><code>automation:\n- id: chauffageoff\nalias: chauffage off\ntrigger:\n- platform: numeric_state\nentity_id: sensor.shellyht_7020b3_temperature\nabove: 21\nfor:\nminutes: 10\ncondition:  - condition: state\nentity_id: climate.salon_ac\nstate: 'heat'\naction:\n- service: climate.turn_off\ndata: {}\ntarget:\nentity_id: climate.salon_ac\n</code></pre> <p>Le chauffage est allum\u00e9 si :</p> <ul> <li>la temp\u00e9rature de la pi\u00e8ce inf\u00e9rieure 19\u00b0 pendant 10 minutes,</li> <li>il est plus de 5 heure (matin)</li> </ul> <p>Cela permet de remettre le chauffage le matin, s'il a \u00e9t\u00e9 coup\u00e9 et que la temp\u00e9rature est trop basse.  </p> <pre><code>automation:\n- id: chauffageon\nalias: chauffage on\ntrigger:\n- platform: numeric_state\nentity_id: sensor.shellyht_7020b3_temperature\nbelow: 19\nfor:\nminutes: 10\ncondition:\n- condition: and\nconditions:\n- condition: time\nafter: '05:00:00'\naction:\n- service: climate.turn_on\ndata: {}\ntarget:\nentity_id: climate.salon_ac\n</code></pre>"},{"location":"blog/","title":"Articles","text":""},{"location":"blog/2023/07/18/creation-dun-blog-prise-de-notes/","title":"Cr\u00e9ation d'un blog &amp; prise de notes","text":"<p>D\u00e9veloppeur depuis plus de 30 ans, curieux et passionn\u00e9 de technologie, j'ai accumul\u00e9 au fil du temps de nombreuses notes, bookmarks et autres listes d'articles \u00e0 lire. Difficile de tout garder en m\u00e9moire et d'exploiter ces contenus. Pour rem\u00e9dier \u00e0 cette accumulation de donn\u00e9es, sur lesquelles je finis par ne plus revenir, j'ai d\u00e9cid\u00e9 d'en faire la synth\u00e8se \u00e0 travers ce blog.</p> <p>Pour cela, j'ai mis en place un syst\u00e8me de prise de note en 4 \u00e9tapes :</p> <ol> <li> <p>R\u00e9cup\u00e9ration</p> <p>La premi\u00e8re \u00e9tape de ce processus est de r\u00e9cup\u00e9rer les articles et id\u00e9es \u00e9parpill\u00e9es dans de nombreux outils (evernote, google keep, Joplin, pocket, boites mails), puis de les regrouper au m\u00eame endroit dans un format simple et durable dans le temps. Pour ce faire, j'ai opt\u00e9 pour du markdown, \u00e9ditable par de nombreux outils et pouvant \u00eatre versionn\u00e9, comme cela est fait pour du code applicatif. Autre avantage, ce format est directement visualisable sous Github ou Gitlab.</p> </li> <li> <p>Parcours</p> <p>Le parcours consiste \u00e0 revisiter les notes et id\u00e9es saisies pr\u00e9c\u00e9demment, \u00e0 les lier entre elles (lien markdown) et de leur ajouter des mots cl\u00e9s (ou tags). Cela permet ensuite de faire des recherches fulltext autour d'une notion et d'identifier l'ensemble des notes concern\u00e9es. Quand une note n'est encore qu'une r\u00e9f\u00e9rence (contenu brut issu de la r\u00e9flexion d'un autre), un passage dans un livre ou un article de blog par exemple, il faut alors en faire la synth\u00e8se avec ses propres mots. Cela permet de s'approprier le sujet et constitue un premier apprentissage.</p> </li> <li> <p>Pratique</p> <p>La pratique consiste \u00e0 mettre en \u0153uvre une id\u00e9e, un concept ou un outil, dans un projet. Il n'est pas conseill\u00e9, dans le cadre professionnel, d'introduire un nouveau sujet dans l'unique but d'apprendre mais plut\u00f4t pour r\u00e9pondre \u00e0 un besoin. Par contre, tout est permis dans un projet personnel. A l'issue de cette phase concr\u00e8te, de nouvelles id\u00e9es vont venir compl\u00e9ter celle de d\u00e9part et faire l'objet de nouvelles notes. On obtient ainsi une boucle note -&gt; pratique -&gt; note, permettant d'approfondir un sujet petit \u00e0 petit, sans trop d'effort, jusqu\u2019\u00e0 obtenir une connaissance solide dans un domaine.</p> </li> <li> <p>R\u00e9daction</p> <p>La derni\u00e8re \u00e9tape est la r\u00e9daction de l'article pour ce blog. Le sujet abord\u00e9 pourra alors continuer \u00e0 \u00e9voluer ou \u00eatre remis en question \u00e0 l'issue de votre lecture et des vos remarques.</p> </li> </ol> <p>Cet article (et par extension ce blog) est issu de ce processus. Le constat d'accumulation m'a amen\u00e9 \u00e0 chercher comment prendre des notes de fa\u00e7ons plus efficaces, ce qui m'a fait d\u00e9couvrir les concepts de second brain ou de Zettelkasten dont je me suis inspir\u00e9. La mise en pratique consiste dans l'\u00e9criture de ce billet. Vos retours et la gestion du blog, devraient rapidement permettre d'affiner le processus, puis de r\u00e9diger de nouvelle notes, qui \u00e0 leur tour feront peut-\u00eatre l'objet d'un nouvel article. Au niveau des outils j'utilise <code>vscode</code> pour l'\u00e9dition, le plugin <code>Foam for VSCode</code>, et <code>github</code> pour le versioning.</p>"}]}