{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Home assistant Home Assistant est un logiciel domotique open source que j'utilise afin de rendre ma maison \"intelligente\". Je vais vous pr\u00e9senter les principaux sc\u00e9narios d'automatisation que j'utilise au quotidien. Automatisations L'objectif est de mettre en place des actions automatiques en r\u00e9ponse \u00e0 des \u00e9v\u00e9nements survenant au sein de la maison. Allumer des lumi\u00e8res au r\u00e9veil Notification de connexion Mes sources d'inspiration The Anchorage House Home Assistant Configuration Isabella Gross Alstr\u00f6m Home Assistant Configuration","title":"Home assistant"},{"location":"#home-assistant","text":"Home Assistant est un logiciel domotique open source que j'utilise afin de rendre ma maison \"intelligente\". Je vais vous pr\u00e9senter les principaux sc\u00e9narios d'automatisation que j'utilise au quotidien.","title":"Home assistant"},{"location":"#automatisations","text":"L'objectif est de mettre en place des actions automatiques en r\u00e9ponse \u00e0 des \u00e9v\u00e9nements survenant au sein de la maison. Allumer des lumi\u00e8res au r\u00e9veil Notification de connexion","title":"Automatisations"},{"location":"#mes-sources-dinspiration","text":"The Anchorage House Home Assistant Configuration Isabella Gross Alstr\u00f6m Home Assistant Configuration","title":"Mes sources d'inspiration"},{"location":"reveil/","text":"R\u00e9veil Objectif Allumer 2 lampes \u00e0 l'heure du r\u00e9veil. Mat\u00e9riel utilis\u00e9 2 ampoules de marque Wiz positionn\u00e9es dans le salon et la salle \u00e0 manger 1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour r\u00e9cup\u00e9rer l'heure de la prochaine alarme (heure de r\u00e9veil). Mise en oeuvre Les ampoules de marque Wiz ne sont actuellement pas reconnues par Home Assitant, mais sont int\u00e9gr\u00e9es dans d'autres solutions. J'ai utilis\u00e9 l'int\u00e9gration Home Assistant/SmartThings pour contourner le probl\u00e8me. La solution est loin d'\u00eatre id\u00e9ale puisqu'il faut passer par un serveur distant pour effectuer une action sur une ampoule locale. Cela pose des probl\u00e8mes de confidentialit\u00e9, d'ind\u00e9pendance vis \u00e0 vis d'un service externe (qui pourrait s'arr\u00eater ou devenir payant), mais aussi par rapport \u00e0 la latence que cela peut induire. Script r\u00e9veil Permet d'allumer les ampoules et de r\u00e9gler puissance et temp\u00e9rature. scripts : reveil : alias : reveil sequence : - service : light.turn_on data : brightness : 80 color_temp : 1000000 entity_id : light.salle_a_manger - service : light.turn_on data : {} entity_id : light.salon mode : single icon : mdi:alarm Automation L'automation se base sur l'heure de la prochaine alarme remont\u00e9e par l'application mobile : sensor.pixel_2_xl_next_alarm . Le script reveil est appel\u00e9 quand l'heure de reveil est atteinte si le mode vacance n'a pas \u00e9t\u00e9 activ\u00e9. automation : - id : lumierereveil alias : allumer lumi\u00e8res au r\u00e9veil trigger : - platform : template value_template : > {{now().strftime(\"%a %h %d %H:%M %Z %Y\") == (((state_attr('sensor.pixel_2_xl_next_alarm', 'Time in Milliseconds') | int / 1000) + 0*60 ) | timestamp_custom('%a %h %d %H:%M %Z %Y'))}} condition : - condition : state entity_id : input_boolean.mode_vacance state : 'off' action : - service : script.reveil","title":"R\u00e9veil"},{"location":"reveil/#reveil","text":"Objectif Allumer 2 lampes \u00e0 l'heure du r\u00e9veil.","title":"R\u00e9veil"},{"location":"reveil/#materiel-utilise","text":"2 ampoules de marque Wiz positionn\u00e9es dans le salon et la salle \u00e0 manger 1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour r\u00e9cup\u00e9rer l'heure de la prochaine alarme (heure de r\u00e9veil).","title":"Mat\u00e9riel utilis\u00e9"},{"location":"reveil/#mise-en-oeuvre","text":"Les ampoules de marque Wiz ne sont actuellement pas reconnues par Home Assitant, mais sont int\u00e9gr\u00e9es dans d'autres solutions. J'ai utilis\u00e9 l'int\u00e9gration Home Assistant/SmartThings pour contourner le probl\u00e8me. La solution est loin d'\u00eatre id\u00e9ale puisqu'il faut passer par un serveur distant pour effectuer une action sur une ampoule locale. Cela pose des probl\u00e8mes de confidentialit\u00e9, d'ind\u00e9pendance vis \u00e0 vis d'un service externe (qui pourrait s'arr\u00eater ou devenir payant), mais aussi par rapport \u00e0 la latence que cela peut induire.","title":"Mise en oeuvre"},{"location":"reveil/#script-reveil","text":"Permet d'allumer les ampoules et de r\u00e9gler puissance et temp\u00e9rature. scripts : reveil : alias : reveil sequence : - service : light.turn_on data : brightness : 80 color_temp : 1000000 entity_id : light.salle_a_manger - service : light.turn_on data : {} entity_id : light.salon mode : single icon : mdi:alarm","title":"Script r\u00e9veil"},{"location":"reveil/#automation","text":"L'automation se base sur l'heure de la prochaine alarme remont\u00e9e par l'application mobile : sensor.pixel_2_xl_next_alarm . Le script reveil est appel\u00e9 quand l'heure de reveil est atteinte si le mode vacance n'a pas \u00e9t\u00e9 activ\u00e9. automation : - id : lumierereveil alias : allumer lumi\u00e8res au r\u00e9veil trigger : - platform : template value_template : > {{now().strftime(\"%a %h %d %H:%M %Z %Y\") == (((state_attr('sensor.pixel_2_xl_next_alarm', 'Time in Milliseconds') | int / 1000) + 0*60 ) | timestamp_custom('%a %h %d %H:%M %Z %Y'))}} condition : - condition : state entity_id : input_boolean.mode_vacance state : 'off' action : - service : script.reveil","title":"Automation"},{"location":"ssh-login-notification/","text":"Notification de connexion Objectif Envoyer une notification lors d'une connexion en ssh sur mon serveur NAS. Mat\u00e9riel utilis\u00e9 1 serveur NAS permettant la connexion distante par ssh 1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour recevoir la notification. Mise en oeuvre Lors d'une connexion ssh les commandes pr\u00e9sentes dans le fichier /etc/ssh/sshrc sont ex\u00e9cut\u00e9es. En ajoutant les lignes de commandes suivantes il est possible d'appeler un WEBHOOK au niveau de Home Assistant. sshrc #!/bin/bash ip = $( echo \" $SSH_CONNECTION \" | cut -d \" \" -f 1 ) hs = $( hostname ) hostIP = \" $( ip address show dev eth0 | grep \"inet \" | head --lines = 1 | cut --delimiter = ' ' --fields = 6 | cut --delimiter = '/' --fields = 1 ) \" logger -t ssh-wrapper \" $USER \" login from \" $ip \" curl --header \"Content-Type: application/json\" \\ --request POST \\ --data \\ '{\"topic\": \"' \" $hs \" '\", \"host\": \"' \" $hs \" '\", \"hostIP\": \"' \" $hostIP \" '\", \"user\": \"' \" $USER \" '\", \"from\": \"' \" $ip \" '\", \"message\": \"' \" $USER @ $hs just logged in from $ip \" '\"}' \\ http://localhost:8123/api/webhook/MY-SSH-WEBHOOK La derni\u00e8re ligne doit \u00eatre adapt\u00e9e avec l'adresse de votre instance Home Assistant. Dans mon cas, elle est situ\u00e9e sur la m\u00eame machine. Traitement du WEBHOOK A la r\u00e9ception du WEBHOOK, le sensor ssh_login prend la valeur du message envoy\u00e9 (bob@nas just logged in from 192.168.1.2 par exemple). Au changement de valeur du sensor ssh_login, le service de notification est appel\u00e9 avec le message stock\u00e9 sur le sensor. automation : - id : ssh_login_notify alias : notify nas ssh login trigger : - platform : state entity_id : sensor.ssh_login action : service : notify.mobile_app_pixel_2_xl data : message : '{{ states.sensor.ssh_login.state }}' template : - trigger : - platform : webhook webhook_id : MY-SSH-WEBHOOK sensor : - name : \"ssh_login\" state : \"{{ trigger.json.message }}\"","title":"Notification de connexion"},{"location":"ssh-login-notification/#notification-de-connexion","text":"Objectif Envoyer une notification lors d'une connexion en ssh sur mon serveur NAS.","title":"Notification de connexion"},{"location":"ssh-login-notification/#materiel-utilise","text":"1 serveur NAS permettant la connexion distante par ssh 1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour recevoir la notification.","title":"Mat\u00e9riel utilis\u00e9"},{"location":"ssh-login-notification/#mise-en-oeuvre","text":"Lors d'une connexion ssh les commandes pr\u00e9sentes dans le fichier /etc/ssh/sshrc sont ex\u00e9cut\u00e9es. En ajoutant les lignes de commandes suivantes il est possible d'appeler un WEBHOOK au niveau de Home Assistant.","title":"Mise en oeuvre"},{"location":"ssh-login-notification/#sshrc","text":"#!/bin/bash ip = $( echo \" $SSH_CONNECTION \" | cut -d \" \" -f 1 ) hs = $( hostname ) hostIP = \" $( ip address show dev eth0 | grep \"inet \" | head --lines = 1 | cut --delimiter = ' ' --fields = 6 | cut --delimiter = '/' --fields = 1 ) \" logger -t ssh-wrapper \" $USER \" login from \" $ip \" curl --header \"Content-Type: application/json\" \\ --request POST \\ --data \\ '{\"topic\": \"' \" $hs \" '\", \"host\": \"' \" $hs \" '\", \"hostIP\": \"' \" $hostIP \" '\", \"user\": \"' \" $USER \" '\", \"from\": \"' \" $ip \" '\", \"message\": \"' \" $USER @ $hs just logged in from $ip \" '\"}' \\ http://localhost:8123/api/webhook/MY-SSH-WEBHOOK La derni\u00e8re ligne doit \u00eatre adapt\u00e9e avec l'adresse de votre instance Home Assistant. Dans mon cas, elle est situ\u00e9e sur la m\u00eame machine.","title":"sshrc"},{"location":"ssh-login-notification/#traitement-du-webhook","text":"A la r\u00e9ception du WEBHOOK, le sensor ssh_login prend la valeur du message envoy\u00e9 (bob@nas just logged in from 192.168.1.2 par exemple). Au changement de valeur du sensor ssh_login, le service de notification est appel\u00e9 avec le message stock\u00e9 sur le sensor. automation : - id : ssh_login_notify alias : notify nas ssh login trigger : - platform : state entity_id : sensor.ssh_login action : service : notify.mobile_app_pixel_2_xl data : message : '{{ states.sensor.ssh_login.state }}' template : - trigger : - platform : webhook webhook_id : MY-SSH-WEBHOOK sensor : - name : \"ssh_login\" state : \"{{ trigger.json.message }}\"","title":"Traitement du WEBHOOK"}]}